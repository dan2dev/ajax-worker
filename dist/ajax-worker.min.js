"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ajax_work_1=require("./ajax-work"),resolveRelative=require("resolve-relative-url"),newHashFrom=require("object-hash"),utility_collection_1=require("utility-collection"),uniqid_1=require("uniqid"),AjaxWorker=function(){return function(){}}();exports.AjaxWorker=AjaxWorker,function(r){var e,o,t="ajaxworkercache",n={onDone:function(r){!function(r){var e=new utility_collection_1.Url(r.url);e.deleteQuery(t),r.url=e.toString();var o=new utility_collection_1.Url(r.url);if(o.deleteQuery(t),r.urlRedirected=o.toString(),void 0!==u[r.hash]){var n=u[r.hash];!0===r.error?void 0!==n.onError&&n.onError(r):void 0!==n.onSuccess&&n.onSuccess(r),void 0!==n.onDone&&n.onDone(r)}}(r[0])},onAbort:function(r){!function(r){if(void 0!==u[r.hash]){var e=u[r.hash];!0===r.abort&&void 0!==e.onAbort&&e.onAbort(r)}}(r[0])},clean:function(){u={}}};function i(r,t){(function(){void 0===o&&((o=new Worker(function(){if(void 0===e){var r=new Blob(["("+ajax_work_1.default.Worker.toString()+")();"],{type:"application/javascript"});e=window.URL.createObjectURL(r)}return e}())).onmessage=function(r){n[r.data.method](r.data.args)});return o})().postMessage({method:r,args:t})}var a=0;var u={};r.fetch=function(r){var e,o=Object.assign({url:null,method:"GET",returnType:"json",cache:"no-cache",credentials:"include",referrerPolicy:"no-referrer",mode:"cors",sync:!0,id:null,abort:!1},r);"string"!=typeof o.body&&(o.body=JSON.stringify(o.body)),o.url=resolveRelative(o.url,window.location.origin),o.hash=function(r){var e=Object.assign({},r);for(var o in e)"function"==typeof e[o]&&delete e[o];return newHashFrom(e)}(o),o.id=(e=o.id,a+=1,null!=e?e:a.toString());var n=new utility_collection_1.Url(o.url);for(var c in n.setQuery(t,uniqid_1.process()),o.url=n.toString(),u[o.hash]=Object.assign({},o),o)"function"==typeof o[c]&&delete o[c];i("fetch",[o])},r.init=function(){var r=window;void 0===r.ajaxWorker&&(r.ajaxWorker=this)}}(AjaxWorker=exports.AjaxWorker||(exports.AjaxWorker={})),exports.AjaxWorker=AjaxWorker,AjaxWorker.init(),exports.default=AjaxWorker;
